name: Cleanup Projects

on:
  workflow_dispatch:

permissions:
  actions: write

jobs:
  clean-all:
    runs-on: ubuntu-latest
    steps:
      - name: Delete Failed Workflow Runs
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Hapus workflow runs yang gagal
          gh run list --status failure --json databaseId -q '.[].databaseId' | \
          while read run_id; do
            echo "Deleting run: $run_id"
            gh run delete $run_id || true
          done

      - name: Delete All Caches
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Deleting all caches..."
          gh cache delete --all --succeed-on-no-caches