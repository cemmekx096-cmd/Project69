name: Cleanup Failed Workflow Runs
on:
  schedule:
    - cron: '0 0 * * 0'  # Setiap hari Minggu
  workflow_dispatch:  # Bisa dijalankan manual

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Delete failed workflow runs
        run: |
          # Install jq jika belum ada
          sudo apt-get install -y jq
          
          # Hapus workflow runs yang gagal (max 100 terbaru)
          gh run list --status failure --json databaseId --limit 100 | \
            jq '.[].databaseId' | \
            xargs -I {} gh run delete {}
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}