name: Cleanup ðŸ”¥ðŸ”¥ðŸ”¥

on:
  workflow_dispatch:

permissions:
  actions: write

jobs:
  clean-all:
    runs-on: ubuntu-latest
    steps:
      - name: Cleanup Everything
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          python3 << 'EOF'
          import os
          import requests
          import json

          token = os.environ['GH_TOKEN']
          repo = "${{ github.repository }}"
          headers = {
              'Authorization': f'token {token}',
              'Accept': 'application/vnd.github.v3+json'
          }

          # Hapus failed runs
          print("Deleting failed workflow runs...")
          runs_url = f'https://api.github.com/repos/{repo}/actions/runs?status=failure&per_page=100'
          runs = requests.get(runs_url, headers=headers).json()
          
          for run in runs.get('workflow_runs', []):
              run_id = run['id']
              print(f"Deleting run: {run_id}")
              requests.delete(f'https://api.github.com/repos/{repo}/actions/runs/{run_id}', headers=headers)

          # Hapus semua cache
          print("\nDeleting all caches...")
          caches_url = f'https://api.github.com/repos/{repo}/actions/caches?per_page=100'
          caches = requests.get(caches_url, headers=headers).json()
          
          for cache in caches.get('actions_caches', []):
              cache_id = cache['id']
              print(f"Deleting cache: {cache_id}")
              requests.delete(f'https://api.github.com/repos/{repo}/actions/caches/{cache_id}', headers=headers)

          print("\nâœ… Cleanup complete!")
          EOF